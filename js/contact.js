const contactTranslations = {
    vi: {
        'contact.hero.title': 'Liên hệ với chúng tôi',
        'contact.hero.subtitle': 'Chúng tôi luôn sẵn sàng lắng nghe và hỗ trợ bạn',
        'contact.info.address.title': 'Địa chỉ',
        'contact.info.address.line1': 'Số 12 ngõ 126 Mễ Trì Hạ',
        'contact.info.address.line2': 'Nam Từ Liêm, Hà Nội, Việt Nam',
        'contact.info.phone.title': 'Điện thoại',
        'contact.info.email.title': 'Email',
        'contact.form.title': 'Gửi tin nhắn cho chúng tôi',
        'contact.form.subtitle': 'Điền vào biểu mẫu bên dưới và chúng tôi sẽ phản hồi sớm nhất có thể',
        'contact.form.name': 'Họ và tên',
        'contact.form.email': 'Email',
        'contact.form.phone': 'Số điện thoại',
        'contact.form.subject': 'Chủ đề',
        'contact.form.subjectSelect': 'Chọn chủ đề',
        'contact.form.subjectGeneral': 'Thông tin chung',
        'contact.form.subjectSupport': 'Hỗ trợ kỹ thuật',
        'contact.form.subjectPartnership': 'Hợp tác kinh doanh',
        'contact.form.subjectCareer': 'Tuyển dụng',
        'contact.form.subjectOther': 'Khác',
        'contact.form.message': 'Tin nhắn',
        'contact.form.newsletter': 'Tôi muốn nhận thông tin về sản phẩm mới',
        'contact.form.submit': 'Gửi tin nhắn',
        'contact.hours.title': 'Giờ làm việc',
        'contact.hours.weekdays': 'Thứ 2 - Thứ 6:',
        'contact.hours.saturday': 'Thứ 7:',
        'contact.hours.sunday': 'Chủ nhật:',
        'contact.hours.closed': 'Nghỉ',
        'contact.social.title': 'Kết nối với chúng tôi',
        'contact.quick.title': 'Liên hệ nhanh',
        'contact.quick.desc': 'Cần hỗ trợ ngay? Hãy gọi cho chúng tôi',
        'contact.map.title': 'Tìm chúng tôi trên bản đồ',
        'contact.map.directions': 'Chỉ đường',
        'contact.faq.title': 'Câu hỏi thường gặp',
        'contact.faq.q1': 'Làm thế nào để liên hệ bộ phận hỗ trợ?',
        'contact.faq.a1': 'Bạn có thể liên hệ qua email support@supernovajsc.com hoặc gọi điện thoại trong giờ làm việc.',
        'contact.faq.q2': 'Thời gian phản hồi là bao lâu?',
        'contact.faq.a2': 'Chúng tôi cam kết phản hồi trong vòng 24 giờ làm việc.',
        'contact.faq.q3': 'Tôi có thể ghé thăm văn phòng không?',
        'contact.faq.a3': 'Có, vui lòng liên hệ trước để đặt lịch hẹn.',
        'contact.faq.q4': 'Làm thế nào để hợp tác với SuperNova?',
        'contact.faq.a4': 'Vui lòng gửi đề xuất hợp tác qua email hoặc form liên hệ.',
        'contact.form.errors.name': 'Vui lòng nhập họ và tên',
        'contact.form.errors.email': 'Vui lòng nhập email hợp lệ',
        'contact.form.errors.phone': 'Vui lòng nhập số điện thoại hợp lệ',
        'contact.form.errors.subject': 'Vui lòng chọn chủ đề',
        'contact.form.errors.message': 'Vui lòng nhập nội dung tin nhắn',
        'contact.form.sending': 'Đang gửi...',
        'contact.form.success': 'Gửi thành công! Chúng tôi sẽ phản hồi sớm nhất.',
        'contact.form.error': 'Có lỗi xảy ra. Vui lòng thử lại.'
    },
    en: {
        'contact.hero.title': 'Contact Us',
        'contact.hero.subtitle': 'We\'re always ready to listen and support you',
        'contact.info.address.title': 'Address',
        'contact.info.address.line1': 'No. 12, Lane 126 Me Tri Ha',
        'contact.info.address.line2': 'Nam Tu Liem, Hanoi, Vietnam',
        'contact.info.phone.title': 'Phone',
        'contact.info.email.title': 'Email',
        'contact.form.title': 'Send us a message',
        'contact.form.subtitle': 'Fill out the form below and we\'ll respond as soon as possible',
        'contact.form.name': 'Full Name',
        'contact.form.email': 'Email',
        'contact.form.phone': 'Phone Number',
        'contact.form.subject': 'Subject',
        'contact.form.subjectSelect': 'Select subject',
        'contact.form.subjectGeneral': 'General Information',
        'contact.form.subjectSupport': 'Technical Support',
        'contact.form.subjectPartnership': 'Business Partnership',
        'contact.form.subjectCareer': 'Career',
        'contact.form.subjectOther': 'Other',
        'contact.form.message': 'Message',
        'contact.form.newsletter': 'I want to receive updates about new products',
        'contact.form.submit': 'Send Message',
        'contact.hours.title': 'Office Hours',
        'contact.hours.weekdays': 'Monday - Friday:',
        'contact.hours.saturday': 'Saturday:',
        'contact.hours.sunday': 'Sunday:',
        'contact.hours.closed': 'Closed',
        'contact.social.title': 'Connect with us',
        'contact.quick.title': 'Quick Contact',
        'contact.quick.desc': 'Need immediate support? Call us',
        'contact.map.title': 'Find us on the map',
        'contact.map.directions': 'Get Directions',
        'contact.faq.title': 'Frequently Asked Questions',
        'contact.faq.q1': 'How can I contact support?',
        'contact.faq.a1': 'You can contact us via email at support@supernovajsc.com or call during office hours.',
        'contact.faq.q2': 'What is the response time?',
        'contact.faq.a2': 'We commit to respond within 24 business hours.',
        'contact.faq.q3': 'Can I visit the office?',
        'contact.faq.a3': 'Yes, please contact us in advance to schedule an appointment.',
        'contact.faq.q4': 'How to partner with SuperNova?',
        'contact.faq.a4': 'Please send partnership proposals via email or contact form.',
        'contact.form.errors.name': 'Please enter your name',
        'contact.form.errors.email': 'Please enter a valid email',
        'contact.form.errors.phone': 'Please enter a valid phone number',
        'contact.form.errors.subject': 'Please select a subject',
        'contact.form.errors.message': 'Please enter your message',
        'contact.form.sending': 'Sending...',
        'contact.form.success': 'Sent successfully! We\'ll respond soon.',
        'contact.form.error': 'An error occurred. Please try again.'
    }
};

if (typeof translations !== 'undefined') {
    Object.keys(contactTranslations).forEach(lang => {
        Object.assign(translations[lang], contactTranslations[lang]);
    });
}

const contactModule = {
    form: null,
    currentLang: localStorage.getItem('language') || 'vi',

    init() {
        this.form = document.getElementById('contactForm');
        if (this.form) {
            this.bindFormEvents();
        }
        this.initMap();
    },

    bindFormEvents() {
        this.form.addEventListener('submit', (e) => this.handleSubmit(e));
        
        const inputs = this.form.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
            input.addEventListener('blur', () => this.validateField(input));
            input.addEventListener('input', () => this.clearError(input));
        });

        const phoneInput = this.form.querySelector('#phone');
        if (phoneInput) {
            phoneInput.addEventListener('input', (e) => {
                e.target.value = e.target.value.replace(/[^0-9+\s-]/g, '');
            });
        }
    },

    validateField(field) {
        const fieldName = field.name;
        const value = field.value.trim();
        let isValid = true;

        this.clearError(field);

        switch (fieldName) {
            case 'name':
                if (!value) {
                    this.showError(field, t('contact.form.errors.name', this.currentLang));
                    isValid = false;
                }
                break;
            case 'email':
                if (!value || !this.isValidEmail(value)) {
                    this.showError(field, t('contact.form.errors.email', this.currentLang));
                    isValid = false;
                }
                break;
            case 'phone':
                if (value && !this.isValidPhone(value)) {
                    this.showError(field, t('contact.form.errors.phone', this.currentLang));
                    isValid = false;
                }
                break;
            case 'subject':
                if (!value) {
                    this.showError(field, t('contact.form.errors.subject', this.currentLang));
                    isValid = false;
                }
                break;
            case 'message':
                if (!value) {
                    this.showError(field, t('contact.form.errors.message', this.currentLang));
                    isValid = false;
                }
                break;
        }

        return isValid;
    },

    showError(field, message) {
        const formGroup = field.closest('.form-group');
        const error = document.createElement('div');
        error.className = 'error-message';
        error.textContent = message;
        formGroup.appendChild(error);
        field.style.borderColor = '#dc3545';
    },

    clearError(field) {
        const formGroup = field.closest('.form-group');
        const error = formGroup.querySelector('.error-message');
        if (error) {
            error.remove();
        }
        field.style.borderColor = '';
    },

    isValidEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    },

    isValidPhone(phone) {
        return /^[\d\s+()-]{10,}$/.test(phone);
    },

    async handleSubmit(e) {
        e.preventDefault();
        
        const fields = ['name', 'email', 'subject', 'message'];
        let isValid = true;

        fields.forEach(fieldName => {
            const field = this.form.querySelector(`[name="${fieldName}"]`);
            if (field && !this.validateField(field)) {
                isValid = false;
            }
        });

        const phoneField = this.form.querySelector('[name="phone"]');
        if (phoneField && phoneField.value && !this.validateField(phoneField)) {
            isValid = false;
        }

        if (!isValid) return;

        const submitBtn = this.form.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML = `<span>${t('contact.form.sending', this.currentLang)}</span> <i class="fas fa-spinner fa-spin"></i>`;

        setTimeout(() => {
            this.showMessage(t('contact.form.success', this.currentLang), 'success');
            this.form.reset();
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
        }, 2000);
    },

    showMessage(message, type) {
        const existing = this.form.querySelector('.form-message');
        if (existing) existing.remove();

        const messageEl = document.createElement('div');
        messageEl.className = `form-message ${type}`;
        messageEl.textContent = message;
        this.form.appendChild(messageEl);

        setTimeout(() => messageEl.remove(), 5000);
    },

    initMap() {
        const mapOverlay = document.querySelector('.map-overlay');
        if (mapOverlay) {
            mapOverlay.addEventListener('click', (e) => {
                if (e.target.closest('a')) {
                    e.stopPropagation();
                }
            });
        }
    }
};

document.addEventListener('DOMContentLoaded', () => {
    contactModule.init();
});